# 正则表达式

## 定义

**(1) 使用用字面量**

    var regex = /xyz/;
    var regex = /xyz/i;

**(2) 也可以用构造函数**

    var regex = new RegExp('xyz');
    var regex = new RegExp('xyz', "i"); // 第二个参数表示修饰符
    
## 匹配规则

### 字面量字符

就是字面的含义，比如`/a/`匹配`a`。

### 元字符

除了字面量字符以外，还有一部分字符有特殊含义，不代表字面的意思。它们叫做“元字符”。

* `.` 匹配除回车（\r）、换行(\n)、行分隔符（\u2028）和段分隔符（\u2029）以外的所有字符
* `^` 表示字符串的起首
* `$` 表示字符串的行尾
* `|` 表示“或关系”

### 字符类

字符类（class）表示有一系列字符可供选择，只要匹配其中一个就可以了。所有可供选择的字符都放在方括号内。

有两个字符在字符类中有特殊含义

* `^` 表示除了字符类之中的字符，其他字符都可以匹配
* `-` 表示字符的连续范围

### 重复类

* {n,m} 重复不少于n次，不多于m次
* {n,} 至少重复n次
* {n} 重复n次


### 量词符

* `?` 0次或1次
* `+` 在于等于1次
* `*` 在于等于0次

星号（*）和加号（+）还有非贪婪模式的版本

* `*?` 表示某个模式出现0次或多次，匹配时采用非贪婪模式。
* `+?` 表示某个模式出现1次或多次，匹配时采用非贪婪模式。

### 转义符

正则表达式中那些有特殊含义的字符，如果要匹配它们本身，就需要在它们前面要加上反斜杠。

正则模式中，需要用斜杠转义的，一共有12个字符：^、.、[、$、(、)、|、*、+、?、{和 \。需要特别注意的是，如果使用RegExp方法生成正则对象，转义需要使用两个斜杠，因为字符串内部会先转义一次。

### 修饰符

* `i` 不区分大小写
* `g` 默认情况下，第一次匹配成功后，正则对象就停止向下匹配了。g修饰符表示全局匹配（global），加上它以后，正则对象将匹配全部符合条件的结果，主要用于搜索和替换。
* `m` 字符串的头部或尾部可能会有换行符。默认情况下，正则对象会将换行符算入字符串的开头或结尾。m修饰符表示多行模式（multiline），加上它以后，正则对象会忽略字符串头部或尾部的换行符，即^和$会忽略换行符。

### 预定义模式

预定义模式指的是某些常见模式的简写方式。

* `\d` 匹配0-9之间的任一数字，相当于[0-9]。
* `\D` 匹配所有0-9以外的字符，相当于[^0-9]。
* `\w` 匹配任意的字母、数字和下划线，相当于[A-Za-z0-9_]。
* `\W` 除所有字母、数字和下划线以外的字符，相当于/[^A-Za-z0-9_]/ 。
* `\s` 匹配空格（包括制表符、空格符、断行符等），相等于[\t\r\n\v\f]。
* `\S` 匹配非空格的字符，相当于[^\t\r\n\v\f]。
* `\b` 匹配词的边界。
* `\B` 匹配非词边界，即在词的内部。

### 特殊字符

正则对象对一些不能打印的特殊字符，提供了表达形式。

* `\cX` 表示 Ctrl-X
* `[\b]` 匹配退格键(U+0008)，不要与\b混淆。
* `\n` 匹配换行键。
* `\r` 匹配回车键。
* `\t` 匹配制表符tab（U+0009）。
* `\v` 匹配垂直制表符（U+000B）。
* `\f` 匹配换页符（U+000C）。
* `\0` 匹配null字符（U+0000）。
* `\xhh` 匹配一个以两位十六进制数表示的字符。
* `\uhhhh` 匹配一个以四位十六进制数表示的unicode字符。

### 组匹配

正则表达式的括号表示分组匹配。

可以用`\数字`引用括号匹配的内容，数字是从1开始的自然数，表示对应顺序的括号。

#### 非捕获组

`(?:x)`称为非捕获组，表示不返回该组匹配的内容，即匹配的结果中不计入这个括号。

#### 前瞻断言

前瞻断言包括先行断言和后行断言。

`x(?=y)`称为先行断言，x只有在y前面才匹配，y不会被计入返回结果。

`x(?!y)`称为后行断言，x只有不在y前面才匹配，y不会被计入返回结果。

JS不支持后瞻断言。

`(?<=)x`

`(?<!)x`

## 属性和方法

**ignoreCase**：返回一个布尔值，表示是否设置了i修饰符，该属性只读。

**global**：返回一个布尔值，表示是否设置了g修饰符，该属性只读。

**multiline**：返回一个布尔值，表示是否设置了m修饰符，该属性只读。

	var r = /abc/igm;
	
	r.ignoreCase // true
	r.global // true
	r.multiline // true

**lastIndex**：返回下一次开始搜索的位置。该属性可读写，但是只在设置了g修饰符时有意义。

**source**：返回正则表达式的字符串形式（不包括反斜杠），该属性只读。

	var r = /abc/igm;
	
	r.lastIndex // 0
	r.source // "abc"

**test()**

正则对象的test方法返回一个布尔值，表示当前模式是否能匹配参数字符串。

	/cat/.test('cats and dogs') // true

如果正则表达式带有g修饰符，则每一次test方法都从上一次结束的位置开始向后匹配。

	r.lastIndex // 0
	r.test(s) // true
	
	r.lastIndex // 2
	r.test(s) // true
	
	r.lastIndex // 4
	r.test(s) // false

带有g修饰符时，可以通过正则对象的lastIndex属性指定开始搜索的位置

	var r = /x/g;
	var s = '_x_x';
	
	r.lastIndex = 4;
	r.test(s) // false

**exec()**

正则对象的exec方法，可以返回匹配结果。如果发现匹配，就返回一个数组，每个匹配成功的子字符串，就是数组成员，否则返回null。

	var s = '_x_x';
	var r1 = /x/;
	var r2 = /y/;
	
	r1.exec(s) // ["x"]
	r2.exec(s) // null

如果正则表示式包含圆括号（即要求“组匹配”），则返回的数组会包括多个元素。其中，第一个元素是整个匹配成功的结果，后面的元素就是圆括号对应的匹配成功的组。也就是说，第二个元素对应第一个括号，第三个元素对应第二个括号，以此类推。

exec方法的返回数组还包含以下两个属性：
input：整个原字符串。
index：整个模式匹配成功的开始位置（从0开始）。

	var r = /a(b+)a/;
	var arr = regex.exec("_abbba_aba_");
	
	arr // ["abbba", "bbb"]
	
	arr.index // 1
	arr.input // "_abbba_aba_"

如果正则表达式加上g修饰符，则可以使用多次exec方法，下一次搜索的位置从上一次匹配成功结束的位置开始。

	var r = /a(b+)a/g;
	
	var a1 = r.exec("_abbba_aba_");
	a1 // ["abbba", "bbb"]
	a1.index // 1
	r.lastIndex // 6
	
	var a2 = r.exec("_abbba_aba_");
	a2 // ["aba", "b"]
	a2.index // 7
	r.lastIndex // 10
	
	var a3 = r.exec("_abbba_aba_");
	a3 // null
	a3.index // TypeError: Cannot read property 'index' of null
	r.lastIndex // 0
	
	var a4 = r.exec("_abbba_aba_");
	a4 // ["abbba", "bbb"]
	a4.index // 1
	r.lastIndex // 6
